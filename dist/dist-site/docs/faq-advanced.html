<!DOCTYPE html>
<html>
<head>
    <title>FAQ: RequireJS Advanced Usage</title>

    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    <link rel="stylesheet" type="text/css" href="../main.css">
    <link rel="icon" type="image/x-icon" href="/favicon.png">
    <!--[if IE]> <link rel="stylesheet" type="text/css" href="../ie.css" /> <![endif]-->
    <link rel="stylesheet" type="text/css" href="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojox/highlight/resources/highlight.css">

    <script type="text/javascript" src="http://ajax.googleapis.com/ajax/libs/jquery/1.4.4/jquery.min.js"></script>
    <script type="text/javascript" src="../init.js"></script>
    <script src="http://ajax.googleapis.com/ajax/libs/dojo/1.4/dojo/dojo.xd.js"></script>
    <script type="text/javascript">
        dojo.require("dojox.highlight");
        dojo.require("dojox.highlight.languages.javascript");
        dojo.require("dojox.highlight.languages.html");
        dojo.ready(function() {
            dojo.query("pre > code")
                .forEach(function(node) {
                    if (node.innerHTML.indexOf("DOCTYPE") !== -1 || node.innerHTML.indexOf('&lt;script') !== -1) {
                        dojo.addClass(node, "html");
                    } else {
                        dojo.addClass(node, "javascript");
                    }
                })
                .forEach(dojox.highlight.init);
        });
    </script>
</head>
<body>
<div id="grid"></div>
<div id="wrapper">

    <div id="navBg"></div>
    <button type="button" role="button" aria-label="Toggle Navigation" class="off-canvas-button">
      <span class="lines">
        <span class="line">&nbsp;</span>
        <span class="line">&nbsp;</span>
        <span class="line">&nbsp;</span>
      </span>
      <span class="cross">&times;</span>
    </button>
    <div id="nav" class="mono">
        <a class="homeImageLink" href="../"></a>
        <h1 title="英文原文：a javascript module loader"> javascript <br> 模块加载器 </h1>

        <ul>
            <li class="hbox">
                <a href="../" title="英文原文：Home">首页</a>
                <span class="spacer boxFlex"></span>
                <span class="icon home"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="start.html" title="英文原文：Start">开始</a>
                <span class="spacer boxFlex"></span>
                <span class="icon start"></span>
            </li>
            <li class="hbox">
                <a class="local" href="download.html" title="英文原文：Download">下载</a>
                <span class="spacer boxFlex"></span>
                <span class="icon download"></span>
            </li>
            <li class="hbox">
                <a class="local" href="api.html">API</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
            <li class="hbox">
                <a class="local" href="optimization.html" title="英文原文：Optimization">优化</a>
                <span class="spacer boxFlex"></span>
                <span class="icon optimize"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="jquery.html" title="英文原文：Use with jQuery">和jQuery一起使用</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="node.html" title="英文原文：Use with Node">在Node中运行</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="dojo.html" title="英文原文：Use with Dojo">和Dojo一起使用</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
            <li class="hbox">
                <a class="local" href="commonjs.html" title="英文原文：CommonJS Notes">CommonJS 说明</a>
                <span class="spacer boxFlex"></span>
                <span class="icon script"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="faq.html" title="英文原文：FAQs">常见问题</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="errors.html" title="英文原文：Common Errors">常见异常</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="plugins.html" title="英文原文：Writing Plugins">编写插件</a>
                <span class="spacer boxFlex"></span>
                <span class="icon api"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a class="local" href="why.html" title="英文原文：Why Web Modules">为什么要网页模块化</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="whyamd.html" title="英文原文：Why AMD">为什么要遵循AMD规范</a>
                <span class="spacer boxFlex"></span>
                <span class="icon question"></span>
            </li>
            <li class="hbox">
                <a class="local" href="requirements.html" title="英文原文：Requirements">必要条件</a>
                <span class="spacer boxFlex"></span>
                <span class="icon requirement"></span>
            </li>
            <li class="hbox">
                <a class="local" href="history.html" title="英文原文：History">历史</a>
                <span class="spacer boxFlex"></span>
                <span class="icon history"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="https://stackoverflow.com/questions/tagged/requirejs" title="英文原文：Get Help">获取帮助</a>
                <span class="spacer boxFlex" title="英文原文：Home"></span>
                <span class="icon help"></span>
            </li>
            <li class="hbox">
                <a href="http://jrburke.com/" title="英文原文：Blog">博客</a>
                <span class="spacer boxFlex"></span>
                <span class="icon blog"></span>
            </li>
            <li class="hbox">
                <a href="http://twitter.com/jrburke">Twitter</a>
                <span class="spacer boxFlex"></span>
                <span class="icon twitter"></span>
            </li>
        </ul>

        <ul>
            <li class="hbox">
                <a href="http://github.com/requirejs/requirejs">GitHub</a>
                <span class="spacer boxFlex"></span>
                <span class="icon git"></span>
            </li>
            <li class="hbox">
                <a class="local" href="contributing.html" title="英文原文：Contributing">贡献</a>
                <span class="spacer boxFlex"></span>
                <span class="icon fork"></span>
            </li>
        </ul>


        <ul>
            <li class="version" title="英文原文：2.2.0 Docs (upgrade info)">2.2.0 文档 (<a href="https://github.com/requirejs/requirejs/wiki/Upgrading-to-RequireJS-2.1">如何升级</a>)</li>
            <!-- <li class="version"><a class="local" href="1.0/">1.0 Doc Link</a></li> -->
        </ul>

    </div>

    <div id="content"><div id="directory" class="section">
<h1>FAQ: RequireJS Advanced Usage</h1>

<ul class="index mono">
<li class="hbox"><a href="#rename">How can I rename require?</a><span class="spacer boxFlex"></span><span class="sect">&sect; 1</span></li>
<li class="hbox"><a href="#css">What about loading CSS?</a><span class="spacer boxFlex"></span><span class="sect">&sect; 2</span></li>
</ul>
</div>

<div class="section">
<h2><a name="rename">How can I rename require/define/requirejs?</a><span class="sectionMark">&sect; 1</span></h2>

<p>RequireJS and its optimization tool need to be version 0.26.0 or higher for this to work.</p>

<p>Why would you want to do this? You may have very strict global namespace requirements
or you may be using code that already defines require/define and you want to avoid interference.</p>

<p>Some notes on this capability:</p>

<ul>
    <li>Make sure to use a source version of require.js, not a minified version.</li>
    <li>Make sure that version of require.js is included in the optimization because the require.js
    file contents are altered for the namespacing to work.</li>
    <li>Code your modules using require/define as normal, then do a build to namespace the values.
    Do not code your modules using the namespaced require/define. It will make your code less
    portable and usable by others.</li>
    <li>This transformation/optimization only works once. Do not use the output of this optimization as
    input to another optimization/build stage.</li>
</ul>

<p>The following example optimization config is based on the directory structure
used in the example on the <a href="optimization.html"> optimization page</a>. This config combines
require.js with main.js into a new <strong>foo.js</strong>. file. define() is renamed to <strong>foo.define()</strong>
and require() is renamed to <strong>foo.require()</strong>:</p>

<pre><code>
{
    appDir: "../",
    baseUrl: "scripts",
    dir: "../../appdirectory-build",

    //Put in a mapping so that 'requireLib' in the
    //modules section below will refer to the require.js
    //contents.
    paths: {
        requireLib: 'require'
    },

    //Indicates the namespace to use for require/requirejs/define.
    namespace: "foo",

    modules: [
        {
            name: "foo",
            include: ["requireLib", "main"],
            //True tells the optimizer it is OK to create
            //a new file foo.js. Normally the optimizer
            //wants foo.js to exist in the source directory.
            create: true
        }
    ]
}
</code></pre>


<p>Once this optimization is done, the HTML that used to refer to require.js would
need to be modified to refer to foo.js.</p>

<p>Thanks to <a href="http://ryanflorence.com">Ryan Florence</a> for help on the namespace design.</p>

<hr>

<p>Another approach to renaming, if you prefer to have more direct control of the content, and
want to commit source code with the modifications. This approach <strong>should not be used</strong>
with the "namespace" optimization demonstrated above.</p>

<div class="subSection">
<h4>1) Modify the source of require.js</h4>

<p>There needs to be a wrapper around the require.js code so you can set the require function to the name of your choosing:</p>

<pre><code>var myGlobalRequire = (function () {
    //Define a require object here that has any
    //default configuration you want for RequireJS. If
    //you do not have any config options you want to set,
    //just use an simple object literal, {}. You may need
    //to at least set baseUrl.
    var require = {
        baseUrl: '..'
    };

    //INSERT require.js CONTENTS HERE

    return require;
}());
</code></pre>
</div>

<div class="subSection">
<h4>2) Modify loaded files</h4>

<p>For any files you load with this new function, if those files reference require in any way, you will want to wrap them in an anonymous function to set the value of require to be your new function name that you set up in step 1:</p>

<pre><code>(function (require) {

    //Regular require references now work correctly in here.

}(myGlobalRequire));
</code></pre>

<p>Following the steps above should allow you to use the optimization tool to combine scripts together effectively. If you want your renamed require definition in the optimized script, reference your modified require.js directly in the <strong>include</strong> optimization option, or as the <strong>name</strong> option if you want to optimize that file directly.</p>

<p>Thanks to <a href="http://alexsexton.com/">Alex Sexton</a> and <a href="http://tobielangel.com/">Tobie Langel</a> for suggesting parts of this solution.</p>
</div>

<p></div></p>

<div class="section">
<h2><a name="css">What about loading CSS?</a><span class="sectionMark">&sect; 2</span></h2>

<p>Ideally RequireJS could load CSS files as dependencies. However, there are issues knowing when a CSS file has been loaded, particularly in Gecko/Firefox when the file is loaded from another domain. Some history can be found in <a href="http://bugs.dojotoolkit.org/ticket/5402">this Dojo ticket</a>.</p>

<p>Knowing when the file is loaded  is important because you may only want to grab the dimensions of a DOM element once the style sheet has loaded.</p>

<p>Some people have implemented an approach where they look for a well known style to be applied to a specific HTML element to know if a style sheet is loaded. Due to the specificity of that solution, it is not something that would fit well with RequireJS. Knowing when the link element has loaded the referenced file would be the most robust solution.</p>

<p>Since knowing when the file has loaded is not reliable, it does not make sense to explicitly support CSS files in RequireJS loading, since it will lead to bug reports due to browser behavior. If you do not care when the file is loaded, you can easily write your own function to load CSS on demand by doing the following:</p>

<pre><code>function loadCss(url) {
    var link = document.createElement("link");
    link.type = "text/css";
    link.rel = "stylesheet";
    link.href = url;
    document.getElementsByTagName("head")[0].appendChild(link);
}
</code></pre>
</div>
    </div>
    <div id="footer" class="mono">
        <span class="line" title="英文原文：Latest Release: 2.2.0">最新发布版本: <a href="/docs/download.html">2.2.0</a></span>
        <span class="line" title="英文原文：Open source: new BSD or MIT licensed">开源协议: <a href="https://github.com/requirejs/requirejs/blob/master/LICENSE">NEW BSD 或者 MIT 许可</a></span>
        <span class="line" title="英文原文：web design by Andy Chung &copy; 2011-2015">网站由 <a href="http://andychung.me/">Andy Chung</a> 设计 &copy; 2011-2015</span>
    </div>
</div>

</body>
</html>
